pico-8 cartridge // http://www.pico-8.com
version 41
__lua__

function _init()
  cls()

  palt(7, true) -- beige color as transparency is true
  palt(0, false) -- black color as transparency is false

	init_joka()
end

function _update()
	update_joka()
	move_actor(joka)
	update_camera()
end

function _draw()
	map()
	draw_joka()
	
end
-->8
--joka


function init_joka()
	joka={
		spr={
			id=1,
			w=2,
			h=3,
		},
		w=2*8,
		h=3*8,
		x=15,
		y=15,
		dx=0,
		dy=0,
		t=0,
		frame=0,
		inertia=10,
		bounce=1
	}
end

function update_joka()
	pl=joka
	 -- how fast to accelerate
 accel = 1
 if (btn(0)) pl.dx -= accel 
 if (btn(1)) pl.dx += accel 
 if (btn(2)) pl.dy -= accel 
 if (btn(3)) pl.dy += accel 

 -- play a sound if moving
 -- (every 4 ticks)
 
 if (abs(pl.dx)+abs(pl.dy) > 0.1
     and (pl.t%4) == 0) then
  sfx(1)
 end
	
	
end

function draw_joka()
	s=joka.spr
	spr(s.id,joka.x,joka.y,s.w,s.h)
	--sspr(8,0,16,24,joka.x,joka.y,16,24)
end
-->8
-- camera

function update_camera()
	camx=joka.x-64
	camy=joka.y-64
	camera(camx,camy)
end
-->8
-- collision


function solid(x, y)

 -- grab the cell value
 val=mget(x, y)
 
 -- check if flag 1 is set (the
 -- orange toggle button in the 
 -- sprite editor)
 return fget(val, 1)
 
end

-- solid_area
-- check if a rectangle overlaps
-- with any walls

--(this version only works for
--actors less than one tile big)

function solid_area(x, y, w, h)
  -- check each cell within the bounding box
  for i = -w, w do
    for j = -h, h do
      -- calculate the cell position
      local cell_x = flr((x+i)/8)
      local cell_y = flr((y+j)/8)
      -- check if the cell is solid
      if solid(cell_x, cell_y) then
        return true
      end
    end
  end
  return false
end


function move_actor(a)

 -- only move actor along x
 -- if the resulting position
 -- will not overlap with a wall

 if not solid_area(a.x + a.dx, 
  a.y, a.w, a.h) then
  a.x += a.dx
 else   
  -- otherwise bounce
  a.dx *= -a.bounce
  --sfx(2)
 end

 if not solid_area(a.x, 
  a.y + a.dy, a.w, a.h) then
  a.y += a.dy
 else
  a.dy *= -a.bounce
  --sfx(2)
 end
 
 -- apply inertia
 -- set dx,dy to zero if you
 -- don't want inertia
 
 a.dx = 0
 a.dy = 0
 
 -- advance one frame every
 -- time actor moves 1/4 of
 -- a tile
 
 a.frame += abs(a.dx) * 4
 a.frame += abs(a.dy) * 4
 a.frame %= 2 -- always 2 frames

 a.t += 1
 
end


__gfx__
00000000777700000007777777444477744444475555555544444444666666660000000000000000000000000000000000000000000000000000000000000000
000000007770444444407777774fff77744444475555555544444444666666660000000000000000000000000000000000000000000000000000000000000000
007007007704444444440777774fff77744ffff75555555544444444666666660000000000000000000000000000000000000000000000000000000000000000
00077000704444444444407777411177744ff0f75555555544444444666666660000000000000000000000000000000000000000000000000000000000000000
00077000044444444444440777111177744ffff75555555544444444666666660000000000000000000000000000000000000000000000000000000000000000
0070070004444444444444407711f177744ffff75555555544444444666666660000000000000000000000000000000000000000000000000000000000000000
00000000044444444444444077111177744ff8875555555544444444666666660000000000000000000000000000000000000000000000000000000000000000
00000000044444444444444077722777744111175555555544444444666666660000000000000000000000000000000000000000000000000000000000000000
00000000044444f0fff0444077777777744111170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000004444f0fff0ff44077777777711111170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000004f44f0fff0ff4077777777771111f170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000004f44f0fff0ff0777777777771111f170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000004f44efffffef07777777777711111170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000004444ffffffff07777777777772772770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000004444ff88ffff07777777777772772770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000444000ff000407777777777772772770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000044099999990407700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000040990999990077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000709909999990907700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000070ff09999990f07700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000070ff0aaaaaa0f07700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000770000000000077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007770a07770a0777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007770d07770d0777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70606060606060606060606060606060606060606060606060606060607060606060606060606060700000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70707070707070707070707070707070707070707070707070707070707070707070707070707070700000000000000000000000000000000000000000000000
__gff__
0000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0707070707070707070707070707070707070707070707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060706060606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060706060606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060706060606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060706060606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060706060606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060706060606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060706060606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060706060606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060706060606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060706060606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707050507070707070705050707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0705050505050505050505070505050505050505050505050505050505050507000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0705050505050505050505070505050505050505050505050505050505050507000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0705050505050505050505050505050505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0705050505050505050505050505050505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0705050505050505050505070505050505050505050505050505050505050507000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0705050505050505050505070505050505050505050505050505050505050507000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707050507070707070707070707070707070707070707101007070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060606060606060606060606070606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060606060606060606060606060606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060606060606060606060606060606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060606060606060606060606070606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060606060606060606060606070606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060606060606060606060606070606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060606060606060606060606070606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060606060606060606060606070606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060606060606060606060606070606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060606060606060606060606070606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060606060606060606060606070606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060606060606060606060606070606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060606060606060606060606060606060606060606060606060606070606060606060606060607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
